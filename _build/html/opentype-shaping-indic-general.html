
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Indic script shaping in OpenType &#8212; OpenType Shaping Documents  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="indic-script-shaping-in-opentype">
<h1>Indic script shaping in OpenType<a class="headerlink" href="#indic-script-shaping-in-opentype" title="Permalink to this heading">¶</a></h1>
<p>This document outlines the general shaping procedure shared by all
Indic scripts, and defines the common pieces that script-specific
implementations share.</p>
<p><strong>Table of Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#general-information"><span class="std std-doc">General information</span></a></p></li>
<li><p><a class="reference internal" href="#terminology"><span class="std std-doc">Terminology</span></a></p></li>
<li><p><a class="reference internal" href="#glyph-classification"><span class="std std-doc">Glyph classification</span></a></p>
<ul>
<li><p><a class="reference internal" href="#shaping-classes"><span class="std std-doc">Shaping classes</span></a></p></li>
<li><p><a class="reference internal" href="#mark-placement-subclasses"><span class="std std-doc">Mark-placement subclasses</span></a></p></li>
<li><p><a class="reference internal" href="#character-tables"><span class="std std-doc">Character tables</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-indic2-shaping-model"><span class="std std-doc">The Indic2 shaping model</span></a></p>
<ul>
<li><p><a class="reference internal" href="#sort-ordering"><span class="std std-doc">Sort ordering</span></a></p></li>
<li><p><a class="reference internal" href="#script-shaping-characteristics"><span class="std std-doc">Script shaping characteristics</span></a></p></li>
<li><p><a class="reference internal" href="#identifying-syllables-and-other-sequences"><span class="std std-doc">1: Identifying syllables and other sequences</span></a></p></li>
<li><p><a class="reference internal" href="#initial-reordering"><span class="std std-doc">2: Initial reordering</span></a></p></li>
<li><p><a class="reference internal" href="#applying-the-basic-substitution-features-from-gsub"><span class="std std-doc">3: Applying the basic substitution features from GSUB</span></a></p></li>
<li><p><a class="reference internal" href="#final-reordering"><span class="std std-doc">4: Final reordering</span></a></p></li>
<li><p><a class="reference internal" href="#applying-all-remaining-substitution-features-from-gsub"><span class="std std-doc">5: Applying all remaining substitution features from GSUB</span></a></p></li>
<li><p><a class="reference internal" href="#applying-remaining-positioning-features-from-gpos"><span class="std std-doc">6: Applying remaining positioning features from GPOS</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-old-indic-shaping-model"><span class="std std-doc">The old Indic shaping model</span></a></p></li>
</ul>
<section id="general-information">
<h2>General information<a class="headerlink" href="#general-information" title="Permalink to this heading">¶</a></h2>
<p>The Indic family of scripts includes writing systems
derived from the Brahmi script in ancient India. Although the scripts
vary considerably in appearance, their shared ancestry means that they
also share a number of important features and rules.</p>
<p>This makes it possible (though, of course, not mandatory) for a
shaping engine to implement a single shaping model that covers all of
the scripts.</p>
<p>The largest (by number of readers) scripts in the Indic family are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="opentype-shaping-devanagari.html"><span class="doc std std-doc">Devanagari</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-bengali.html"><span class="doc std std-doc">Bengali</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-gujarati.html"><span class="doc std std-doc">Gujarati</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-gurmukhi.html"><span class="doc std std-doc">Gurmukhi</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-kannada.html"><span class="doc std std-doc">Kannada</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-malayalam.html"><span class="doc std std-doc">Malayalam</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-oriya.html"><span class="doc std std-doc">Oriya</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-tamil.html"><span class="doc std std-doc">Tamil</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-telugu.html"><span class="doc std std-doc">Telugu</span></a></p></li>
<li><p><a class="reference internal" href="opentype-shaping-sinhala.html"><span class="doc std std-doc">Sinhala</span></a></p></li>
</ul>
<p>Text runs in Indic scripts may also include characters from the Vedic
Extensions block in Unicode. This is a set of marks and punctuation
needed to accurately transcribe ancient documents in Sanskrit.</p>
<p>Text runs in Indic scripts also make use of joiner, non-joiner, and
placeholder characters from other Unicode blocks, in order to specify
certain alternate shaping options.</p>
<p>There are two sets of Indic script tags defined in OpenType. Several
from the older set (<code class="docutils literal notranslate"><span class="pre">&lt;deva&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;beng&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;gujr&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;guru&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;knda&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;mlym&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;orya&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;taml&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;telu&gt;</span></code>) were deprecated and
replaced in 2005.</p>
<p>The new set of replacement tags for these scripts (<code class="docutils literal notranslate"><span class="pre">&lt;dev2&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;bng2&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;gjr2&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;gur2&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;knd2&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;mlm2&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;ory2&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tml2&gt;</span></code>, and
<code class="docutils literal notranslate"><span class="pre">&lt;tel2&gt;</span></code>) was devised to overcome shortcomings found in the original model.
Therefore, new fonts should be engineered to work with the updated
shaping model. However, if a font is encountered that supports only
an older script tag, the shaping engine should deal with it gracefully.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;sinh&gt;</span></code> tag, unlike the other Indic script tags,
was not deprecated in 2005 and is still used for Sinhala text.</p>
<blockquote>
<div><p>Note: There are several other scripts derived from the Bhrami script
that are often treated separately and not bundled into the “Indic”
category by shaping engines. This is because these other scripts
evolved to have significantly distinct rules for syllable
construction, reordering, and shaping.</p>
<p>The scripts include Buginese, Balinese, Javanese,
<a class="reference internal" href="opentype-shaping-khmer.html"><span class="doc std std-doc">Khmer</span></a>,
<a class="reference internal" href="opentype-shaping-thai-lao.html"><span class="doc std std-doc">Lao</span></a>,
<a class="reference internal" href="opentype-shaping-myanmar.html"><span class="doc std std-doc">Myanmar</span></a>,
<a class="reference internal" href="opentype-shaping-thai-lao.html"><span class="doc std std-doc">Thai</span></a>, and
<a class="reference internal" href="opentype-shaping-tibetan.html"><span class="doc std std-doc">Tibetan</span></a>.</p>
</div></blockquote>
</section>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading">¶</a></h2>
<p>OpenType shaping uses a standard set of terms for Indic scripts.  The
terms used colloquially in any particular language may vary, however,
potentially causing confusion.</p>
<p><strong>Matra</strong> is the standard term for a dependent vowel sign.</p>
<p>The term “matra” is also used to refer to the headline above letters
in scripts like Devanagari, Bengali, and Gurmukhi. To avoid ambiguity,
the term <strong>headline</strong> is used in most Unicode and OpenType shaping
documents.</p>
<p><strong>Halant</strong> and <strong>Virama</strong> are both standard terms for the below-base
“vowel-killer” sign. Unicode documents use the term “virama” most
frequently, while OpenType documents use the term “halant” most
frequently.</p>
<p><strong>Chandrabindu</strong> (or simply <strong>Bindu</strong>) is the standard term for the
diacritical mark indicating that the preceding vowel should be
nasalized.</p>
<p>The term <strong>base consonant</strong> is also critical to Indic shaping. The
base consonant of a syllable is the consonant that carries the
syllable’s vowel sound, either the inherent vowel (for an unmarked
base consonant) or a dependent vowel (with the addition of a matra).</p>
<p>A syllable’s base consonant is generally rendered in its full form
(although it may form ligatures), while other consonants in the
syllable frequently take on secondary forms. Different GSUB
substitutions may apply to a script’s <strong>pre-base</strong> and <strong>post-base</strong>
consonants. Some of these substitutions create <strong>above-base</strong> or
<strong>below-base</strong> forms. The <strong>Reph</strong> form of the consonant “Ra” is an
example.</p>
<p>Syllables may also begin with an <strong>independent vowel</strong> instead of a
consonant. In these syllables, the independent vowel is rendered in
full-letter form, not as a matra, and the independent vowel serves as the
syllable base, similar to a base consonant.</p>
<p>Where possible, using the standard terminology is preferred, as the
use of a language-specific term necessitates choosing one language
over all of the others that share a common script.</p>
</section>
<section id="glyph-classification">
<h2>Glyph classification<a class="headerlink" href="#glyph-classification" title="Permalink to this heading">¶</a></h2>
<p>Shaping Indic text depends on the shaping engine correctly classifying
each glyph in the run. The classifications must distinguish between
consonants, vowels (independent and dependent), numerals, punctuation,
and various types of diacritical mark.</p>
<p>For most codepoints, the <code class="docutils literal notranslate"><span class="pre">General</span> <span class="pre">Category</span></code> property defined in the
Unicode standard is correct, but it is not sufficient to fully capture
the expected shaping behavior (such as glyph reordering). Therefore,
Indic glyphs must additionally be classified by how they are treated
when shaping a run of text.</p>
<section id="shaping-classes">
<h3>Shaping classes<a class="headerlink" href="#shaping-classes" title="Permalink to this heading">¶</a></h3>
<p>The shaping classes listed in the tables that follow are defined so
that they capture the positioning rules used by Indic scripts.</p>
<p>For most codepoints, the <em>Shaping class</em> is synonymous with the <code class="docutils literal notranslate"><span class="pre">Indic</span> <span class="pre">Syllabic</span> <span class="pre">Category</span></code> defined in Unicode. However, there are some
distinctions, where the defined category does not fully capture the
behavior of the character in the shaping process.</p>
<p>Several of the diacritic and syllable-modifying marks behave according
to their own rules and, thus, have a special class. These include
<code class="docutils literal notranslate"><span class="pre">BINDU</span></code>, <code class="docutils literal notranslate"><span class="pre">VISARGA</span></code>, <code class="docutils literal notranslate"><span class="pre">AVAGRAHA</span></code>, <code class="docutils literal notranslate"><span class="pre">NUKTA</span></code>, and <code class="docutils literal notranslate"><span class="pre">VIRAMA</span></code>. Some
less-common marks behave according to rules that are similar to these
common marks, and are therefore classified with the corresponding
common mark.</p>
<p>Less common mark classes include <code class="docutils literal notranslate"><span class="pre">TONE_MARKER</span></code>, <code class="docutils literal notranslate"><span class="pre">CANTILLATION</span></code>,
<code class="docutils literal notranslate"><span class="pre">GEMINATION_MARK</span></code>, <code class="docutils literal notranslate"><span class="pre">PURE_KILLER</span></code>,  and <code class="docutils literal notranslate"><span class="pre">SYLLABLE_MODIFIER</span></code>. An
explanation of each class is included in the shaping documentation of
each script in which the class occurs.</p>
<p>Letters generally fall into the classes <code class="docutils literal notranslate"><span class="pre">CONSONANT</span></code>,
<code class="docutils literal notranslate"><span class="pre">VOWEL_INDEPENDENT</span></code>, and <code class="docutils literal notranslate"><span class="pre">VOWEL_DEPENDENT</span></code>. These classes help the
shaping engine parse and identify key positions in a syllable. For
example, Unicode categorizes dependent vowels as <code class="docutils literal notranslate"><span class="pre">Mark</span> <span class="pre">[Mn]</span></code>, but the
shaping engine must be able to distinguish between dependent vowels
and diacritical marks (some of which are also categorized as <code class="docutils literal notranslate"><span class="pre">Mark</span> <span class="pre">[Mn]</span></code>).</p>
<p>There are several subclasses of consonants that arise on occasion, such as
<code class="docutils literal notranslate"><span class="pre">CONSONANT_DEAD</span></code>, <code class="docutils literal notranslate"><span class="pre">CONSONANT_MEDIAL</span></code>, <code class="docutils literal notranslate"><span class="pre">CONSONANT_PLACEHOLDER</span></code>,
<code class="docutils literal notranslate"><span class="pre">CONSONANT_WITH_STACKER</span></code>, and <code class="docutils literal notranslate"><span class="pre">CONSONANT_PRE_REPHA</span></code>.</p>
<p>These subclasses indicate that the letter should match simple
tests for consonants (as in the regular expressions used during
syllable identification), but the subclass may factor into
script-specific rules encountered in later shaping stages.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">CONSONANT_DEAD</span></code> indicates that, unlike standard
consonants, the dead consonant carries no inherent vowel. This lack of
an inherent vowel means that the letter is likely not accompanied by a
<code class="docutils literal notranslate"><span class="pre">VIRAMA</span></code>; failure to recognize this distinction could trick a naive
parser into mis-identifying the letter as the base consonant of a
syllable during the base-consonant-identification step.</p>
<p>Not every script features an instance of each consonant subclass. A
full explanation of each subclass’s behavior is explained in the
relevant stage of each script’s shaping documentation.</p>
<p>Other characters, such as symbols and miscellaneous letters (for
example, letter-like symbols that only occur as standalone entities
and do not occur within syllables), need no special attention from the
shaping engine, so they are not assigned a shaping class.</p>
<p>Numbers are classified as <code class="docutils literal notranslate"><span class="pre">NUMBER</span></code>, even though they evoke no special
behavior from the Indic shaping rules, because there are OpenType
features that might affect how the respective glyphs are drawn, such
as <code class="docutils literal notranslate"><span class="pre">tnum</span></code>, which specifies the usage of tabular-width numerals, and
<code class="docutils literal notranslate"><span class="pre">sups</span></code>, which replaces the default glyphs with superscript variants.</p>
</section>
<section id="mark-placement-subclasses">
<h3>Mark-placement subclasses<a class="headerlink" href="#mark-placement-subclasses" title="Permalink to this heading">¶</a></h3>
<p>Marks and dependent vowels are further labeled with a mark-placement
subclass, which indicates where the glyph will be placed with respect
to the base character to which it is attached.</p>
<p>The actual attachment position of these glyphs is determined by the
lookups found in the font’s GPOS table. However, the reordering rules for
Indic scripts require that the shaping engine be able to identify
marks by their general position.</p>
<p>For example, left-side dependent vowels (matras), classified
with <code class="docutils literal notranslate"><span class="pre">LEFT_POSITION</span></code>, must frequently be reordered, with the final
position determined by whether or not other letters in the syllable
have formed ligatures or combined into conjunct forms. Therefore, the
<code class="docutils literal notranslate"><span class="pre">LEFT_POSITION</span></code> subclass of the character must be tracked throughout
the shaping process.</p>
<p>There are four basic <em>mark-placement subclasses</em> for dependent vowels
(matras). Each corresponds to the visual position of the matra with
respect to the syllable base to which it is attached:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LEFT_POSITION</span></code> matras are positioned to the left of the syllable base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RIGHT_POSITION</span></code> matras are positioned to the right of the syllable base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TOP_POSITION</span></code> matras are positioned above the syllable base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BOTTOM_POSITION</span></code> matras are positioned below syllable base.</p></li>
</ul>
<p>These positions may also be referred to elsewhere in shaping documents as:</p>
<ul class="simple">
<li><p><em>Pre-base</em> matras</p></li>
<li><p><em>Post-base</em> matras</p></li>
<li><p><em>Above-base</em> matras</p></li>
<li><p><em>Below-base</em> matras</p></li>
</ul>
<p>respectively. The <code class="docutils literal notranslate"><span class="pre">LEFT</span></code>, <code class="docutils literal notranslate"><span class="pre">RIGHT</span></code>, <code class="docutils literal notranslate"><span class="pre">TOP</span></code>, and <code class="docutils literal notranslate"><span class="pre">BOTTOM</span></code> designations
corresponds to Unicode’s preferred terminology. The <em>Pre</em>, <em>Post</em>,
<em>Above</em>, and <em>Below</em> terminology is used in the official descriptions
of OpenType GSUB and GPOS features. Shaping engines may, internally,
use whichever terminology is preferred.</p>
<p>In addition, dependent-vowel codepoints that are composed of multiple
components will be designated in character tables as having a compound
<em>mark-placement subclass</em>, such as <code class="docutils literal notranslate"><span class="pre">TOP_AND_RIGHT</span></code> or <code class="docutils literal notranslate"><span class="pre">LEFT_AND_RIGHT</span></code>.</p>
<p>However, these multi-part matras are decomposed into separate matra
components during the shaping process. After the decomposition, each
matra component will belong to exactly one of the four basic
<em>mark-placement subclasses</em>.</p>
<p>For most mark and dependent-vowel codepoints, the <em>mark-placement
subclass</em> is synonymous with the <code class="docutils literal notranslate"><span class="pre">Indic</span> <span class="pre">Positional</span> <span class="pre">Category</span></code> defined
in Unicode. However, there are some distinctions, where the defined
category does not fully capture the behavior of the character in the
shaping process.</p>
</section>
<section id="character-tables">
<h3>Character tables<a class="headerlink" href="#character-tables" title="Permalink to this heading">¶</a></h3>
<p>Character tables for all of the scripts, plus the Vedic Extensions and
important miscellaneous characters, are available here:</p>
<ul class="simple">
<li><p><a class="reference internal" href="character-tables/character-tables-devanagari.html"><span class="doc std std-doc">Devanagari</span></a> (Including Devanagari Extended)</p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-bengali.html"><span class="doc std std-doc">Bengali</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-gujarati.html"><span class="doc std std-doc">Gujarati</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-gurmukhi.html"><span class="doc std std-doc">Gurmukhi</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-kannada.html"><span class="doc std std-doc">Kannada</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-malayalam.html"><span class="doc std std-doc">Malayalam</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-oriya.html"><span class="doc std std-doc">Oriya</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-tamil.html"><span class="doc std std-doc">Tamil</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-telugu.html"><span class="doc std std-doc">Telugu</span></a></p></li>
<li><p><a class="reference internal" href="character-tables/character-tables-sinhala.html"><span class="doc std std-doc">Sinhala</span></a></p></li>
</ul>
<section id="special-function-codepoints">
<h4>Special-function codepoints<a class="headerlink" href="#special-function-codepoints" title="Permalink to this heading">¶</a></h4>
<p>Other important characters that may be encountered when shaping runs
of Indic-script text include the dotted-circle placeholder (<code class="docutils literal notranslate"><span class="pre">U+25CC</span></code>), the
zero-width joiner (<code class="docutils literal notranslate"><span class="pre">U+200D</span></code>) and zero-width non-joiner (<code class="docutils literal notranslate"><span class="pre">U+200C</span></code>), and
the no-break space (<code class="docutils literal notranslate"><span class="pre">U+00A0</span></code>).</p>
<p>Each of these is of particular importance to shaping engines, because
these codepoints interact with the shaping engine, the text run, and
the active font, either to mediate non-default shaping behavior or to
relay information about the current shaping process.</p>
<p>The dotted-circle placeholder is frequently used when displaying a
dependent vowel (matra) or a combining mark in isolation. Real-world
text syllables may also use other characters, such as hyphens or dashes,
in a similar placeholder fashion; shaping engines should cope with
this situation gracefully.</p>
<p>Dotted-circle placeholder characters (like any Unicode codepoint) can
appear anywhere in text input sequences and should be rendered
normally. GPOS positioning lookups should attach mark glyphs to dotted
circles as they would to other non-mark characters. As visible glyphs,
dotted circles can also be involved in GSUB substitutions.</p>
<p>In addition to the default input-text handling process, shaping
engines may also insert dotted-circle placeholders into the text
sequence. Dotted-circle insertions are required when a non-spacing
mark or dependent sign is formed with no base character present.</p>
<p>This requirement covers:</p>
<ul class="simple">
<li><p>Dependent signs that are assigned their own individual Unicode
codepoints (such as most dependent-vowel marks or matras)</p></li>
<li><p>Dependent signs that are formed only by specific sequences of
other codepoints (such as “Reph”)</p></li>
</ul>
<p>The zero-width joiner (ZWJ) is primarily used to prevent the formation
of a conjunct from a “<em>Consonant</em>,Halant,<em>Consonant</em>” sequence.</p>
<ul class="simple">
<li><p>The sequence “<em>Consonant</em>,Halant,ZWJ,<em>Consonant</em>” blocks the
formation of a conjunct between the two consonants.</p></li>
</ul>
<p>Note, however, that the “<em>Consonant</em>,Halant” subsequence in the above
example may still trigger a half-forms feature. To prevent the
application of the half-forms feature in addition to preventing the
conjunct, the zero-width non-joiner (ZWNJ) must be used instead.</p>
<ul class="simple">
<li><p>The sequence “<em>Consonant</em>,Halant,ZWNJ,<em>Consonant</em>” should produce
the first consonant in its standard form, followed by an explicit
“Halant”.</p></li>
</ul>
<p>A secondary usage of the zero-width joiner is to prevent the formation of
“Reph” in those scripts that use an implicit sequence to request a
“Reph” form.</p>
<ul class="simple">
<li><p>An initial “Ra,Halant,ZWJ” sequence should not produce a “Reph”,
even where an initial “Ra,Halant” sequence without the zero-width
joiner would otherwise produce a “Reph”.</p></li>
</ul>
<blockquote>
<div><p>Note: this particular usage of ZWJ may not apply to scripts that
feature an explicit “Reph” codepoint or an explicit sequence for
requesting “Reph”. See the script-specific shaping documents for
full details.</p>
</div></blockquote>
<p>The ZWJ and ZWNJ characters are, by definition, non-printing control
characters and have the <em>Default_Ignorable</em> property in the Unicode
Character Database. In standard text-display scenarios, their function
is to signal a request from the user to the shaping engine for some
particular non-default behavior. As such, they are not rendered
visually.</p>
<blockquote>
<div><p>Note: Naturally, there are special circumstances where a user or
document might need to request that a ZWJ or ZWNJ be rendered
visually, such as when illustrating the OpenType shaping process, or
displaying Unicode tables.</p>
</div></blockquote>
<p>Because the ZWJ and ZWNJ are non-printing control characters, they can
be ignored by any portion of a software text-handling stack not
involved in the shaping operations that the ZWJ and ZWNJ are designed
to interface with. For example, spell-checking or collation functions
will typically ignore ZWJ and ZWNJ.</p>
<p>Similarly, the ZWJ and ZWNJ should be ignored by the shaping engine
when matching sequences of codepoints against the backtrack and
lookahead sequences of a font’s GSUB or GPOS lookups.</p>
<p>For example:</p>
<ul class="simple">
<li><p>A lookup that substitutes an alternate version of a
dependent-vowel (matra) glyph when it is preceded by “Ka,Halant,Tta”
should still be applied if the dependent-vowel codepoint is preceded
by “Ka,Halant,ZWJ,Tta” in the text run.</p></li>
</ul>
<p>The no-break space (NBSP) is primarily used to display those
codepoints that are defined as non-spacing (marks, dependent vowels
(matras), below-base consonant forms, and post-base consonant forms)
in an isolated context, as an alternative to displaying them
superimposed on the dotted-circle placeholder. These sequences will
match “NBSP,ZWJ,Halant,<em>Consonant</em>”, “NBSP,<em>mark</em>”, or “NBSP,<em>matra</em>”.</p>
<p>In addition to general punctuation, runs of text in several of the
supported scripts often use the danda (<code class="docutils literal notranslate"><span class="pre">U+0964</span></code>) and double danda
(<code class="docutils literal notranslate"><span class="pre">U+0965</span></code>) punctuation marks from the Devanagari block.</p>
</section>
</section>
</section>
<section id="the-indic2-shaping-model">
<h2>The Indic2 shaping model<a class="headerlink" href="#the-indic2-shaping-model" title="Permalink to this heading">¶</a></h2>
<p>Processing a run of text in any of the modern Indic script tags
involves six top-level stages:</p>
<ol class="arabic simple">
<li><p>Identifying syllables and other sequences</p></li>
<li><p>Initial reordering</p></li>
<li><p>Applying the basic substitution features from GSUB</p></li>
<li><p>Final reordering</p></li>
<li><p>Applying all remaining substitution features from GSUB</p></li>
<li><p>Applying all remaining positioning features from GPOS</p></li>
</ol>
<p>The initial reordering and final reordering stages each involve a set
of script-specific rules that dictate how characters are reordered
from their sequence in the input stream into the correct ordering for
shaping rules to apply.</p>
<p>Specifically, certain consonants in each script are repositioned from
their logical position (that is, their position in the input
stream). The most common example is “Ra”, which is frequently
converted into a combining mark-like form.</p>
<p>The resulting mark must be correctly positioned by attaching it to the
correct base character using the active font’s <code class="docutils literal notranslate"><span class="pre">mark</span></code> lookup from
<code class="docutils literal notranslate"><span class="pre">GPOS</span></code>. Therefore, the mark form of the “Ra” must be moved so that it
is adjacent to the correct base character. Which character in a
syllable is the correct base character differs from script to script,
and may involve several context-sensitive tests.</p>
<p>Similarly, certain other consonants in each script also take on
distinct forms that require reordering so that <code class="docutils literal notranslate"><span class="pre">mark</span></code> positioning
and other lookups function correctly. Dependent vowels (matras) may
also need to be reordered so that they are adjacent to the correct
consonant. These functions, too, involve script-specific rule sets.</p>
<p>Because of the script-specific rules involved, it is mandatory that
the basic substitution features in stage three be applied in the order
specified.</p>
<p>The remaining substitution features in stage five and the positioning
features in stage six, however, do not have a mandatory order.</p>
<section id="sort-ordering">
<h3>Sort ordering<a class="headerlink" href="#sort-ordering" title="Permalink to this heading">¶</a></h3>
<p>A single, canonical sequence of ordering positions exists that
captures all of the possible positions in an Indic syllable.</p>
<p>Not every position is used in every script and not every syllable will
contain a character in every position. Whenever characters in a
syllable are reordered during the shaping process,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>POS_RA_TO_BECOME_REPH
POS_PREBASE_MATRA
POS_PREBASE_CONSONANT

POS_SYLLABLE_BASE
POS_AFTER_MAIN

POS_ABOVEBASE_CONSONANT

POS_BEFORE_SUBJOINED
POS_BELOWBASE_CONSONANT
POS_AFTER_SUBJOINED

POS_BEFORE_POST
POS_POSTBASE_CONSONANT
POS_AFTER_POST

POS_FINAL_CONSONANT
POS_SMVD
</pre></div>
</div>
<p>Not every position is used in every script; the sequence merely
describes all of the possible positions at which a character in an
Indic syllable can exist. Using the same sequence for all scripts
could reduce an implementation’s code size and complexity.</p>
<p>The basic positions (left to right) are “Reph” (<code class="docutils literal notranslate"><span class="pre">POS_RA_TO_BECOME_REPH</span></code>), dependent
vowels (matras) and consonants positioned before the base
consonant or syllable base (<code class="docutils literal notranslate"><span class="pre">POS_PREBASE_MATRA</span></code> and <code class="docutils literal notranslate"><span class="pre">POS_PREBASE_CONSONANT</span></code>), the base
consonant or syllable base (<code class="docutils literal notranslate"><span class="pre">POS_SYLLABLE_BASE</span></code>), above-base consonants
(<code class="docutils literal notranslate"><span class="pre">POS_ABOVEBASE_CONSONANT</span></code>), below-base consonants
(<code class="docutils literal notranslate"><span class="pre">POS_BELOWBASE_CONSONANT</span></code>), consonants positioned after the base consonant or syllable base
(<code class="docutils literal notranslate"><span class="pre">POS_POSTBASE_CONSONANT</span></code>), syllable-final consonants (<code class="docutils literal notranslate"><span class="pre">POS_FINAL_CONSONANT</span></code>),
and syllable-modifying or Vedic signs (<code class="docutils literal notranslate"><span class="pre">POS_SMVD</span></code>).</p>
<p>In addition, several secondary positions are defined to handle various
reordering rules that deal with relative, rather than absolute,
positioning. <code class="docutils literal notranslate"><span class="pre">POS_AFTER_MAIN</span></code> means that a character must be
positioned immediately after the base consonant or syllable base. <code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code>
and <code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code> mean that a character must be positioned
before or after any below-base consonants, respectively. Similarly,
<code class="docutils literal notranslate"><span class="pre">POS_BEFORE_POST</span></code> and <code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code> mean that a character must be
positioned before or after any post-base consonants, respectively.</p>
<p>For shaping-engine implementers, the names used for the ordering
positions matter only in that they are unambiguous.</p>
<p>The description of the general shaping process that follows will note
when a character needs to be marked for reordering into some of these
positions. The specifics for each script provide additional details,
especially for ordering positions that are only used in that script.</p>
</section>
<section id="script-shaping-characteristics">
<h3>Script shaping characteristics<a class="headerlink" href="#script-shaping-characteristics" title="Permalink to this heading">¶</a></h3>
<p>Indic scripts follow many of the same shaping patterns, but they
differ in a few critical characteristics that the shaping engine must
track. These include:</p>
<ul class="simple">
<li><p>The rules that determine the base consonant in a syllable.</p></li>
<li><p>The final position of “Reph”.</p></li>
<li><p>How “Reph” is encoded or requested in a syllable.</p></li>
<li><p>Whether the below-base forms feature is applied only to consonants
after the base consonant or syllable base, or to consonants before the base
consonant and those after the base consonant or syllable base.</p></li>
<li><p>The ordering positions for dependent vowels
(matras). Specifically, the ordering for left-side, right-side,
above-base, and below-base matras follow different rules. The
rules employed vary between scripts, except for left-side matras,
where all Indic scripts follow the same rule.</p></li>
</ul>
<p>In the lists that follow, the options for each characteristic are
mutually exclusive, and they are exhaustive for the set of Indic
scripts <a class="reference internal" href="#general-information"><span class="std std-doc">listed</span></a> at the beginning of this
document (Devanagari, Bengali, Gujarati, Gurmukhi, Kannada, Malayalam,
Oriya, Tamil, Telugu, and Sinhala).</p>
<p>Implementers who wish to cover additional scripts using the same
method would first need to determine whether any additional options
are relevant for each characteristic.</p>
<section id="base-consonant">
<h4>Base consonant<a class="headerlink" href="#base-consonant" title="Permalink to this heading">¶</a></h4>
<p>Locating the base consonant of a syllable generally requires parsing
the syllable to catch and exclude certain special-treatment consonants
(such as “Ra”s that will form “Reph”s or consonants that take on
below-base forms). However, each script has a general base-consonant
position that determines the appropriate search method. The base
consonant may be, generally:</p>
<ul>
<li><p>The first consonant. This is designated <code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code>. This is
the simplest base-consonant rule. After eliminating any initial
“Repha”s from consideration, the first consonant is always the
base consonant, without exception.</p></li>
<li><p>The last consonant, not counting any special forms. This is
designated <code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code>. This is the most complicated
base-consonant rule, because the type and variety of special forms
vary considerably between scripts.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code> search algorithm (described in each script’s
shaping document) accounts for these special forms in every
script. The abundance of special forms in certain scripts may
routinely cause the search algorithm to identify a base consonant
that is not logically last in the syllable. This is expected
behavior.</p>
<p>This base-consonant position is used in Devanagari, Bengali,
Gujarati, Gurmukhi, Kannada, Malayalam, Oriya, Tamil, and Telugu.</p>
</li>
<li><p>The last consonant that is not preceded by a “ZWJ” (zero width
joiner) character.</p>
<p>This position is only used in Sinhala, and is designated
<code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST_SINHALA</span></code>.</p>
</li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding base-consonant rules are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Base-consonant rule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST_SINHALA</span></code></p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Note: None of the specific scripts currently included in the “Indic”
script group as it is enumerated in this document make use of the
<code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code> base-consonant rule. However, the <code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code>
rule is employed by several Brahmi-derived scripts also used in the
region, including both <a class="reference internal" href="opentype-shaping-myanmar.html"><span class="doc std std-doc">Myanmar</span></a> and
<a class="reference internal" href="opentype-shaping-khmer.html"><span class="doc std std-doc">Khmer</span></a>.</p>
<p>Because these scripts share many other characteristics and
conventions with the Indic group described by this document,
<code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code> is included here for comparison.</p>
</div></blockquote>
<blockquote>
<div><p>Note: The <code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code> search algorithm is used for Kannada and
Telugu, although the unique properties of the Kannada and Telugu
orthographies usually result in the search terminating at the first
non-“Reph” consonant in a syllable. Namely, all consonants in
Kannada and Telugu have a post-base form.</p>
<p>This is the expected behavior for Kannada and Telugu, and still
differs from the <code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code> rule as used in the Brahmi-derived
scripts mentioned above. See those individual script pages for
further detail.</p>
</div></blockquote>
</section>
<section id="reph-position">
<h4>Reph position<a class="headerlink" href="#reph-position" title="Permalink to this heading">¶</a></h4>
<p>“Reph” may be positioned:</p>
<ul class="simple">
<li><p>at the beginning of the syllable, in the ordering position
<code class="docutils literal notranslate"><span class="pre">POS_RA_TO_BECOME_REPH</span></code>.</p></li>
<li><p>immediately before the first subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the base consonant or syllable base, in the ordering position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_MAIN</span></code>.</p></li>
<li><p>immediately after the last subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code>.</p></li>
<li><p>immediately before the last post-base consonant, in the ordering
position <code class="docutils literal notranslate"><span class="pre">POS_BEFORE_POST</span></code>.</p></li>
<li><p>immediately after the last post-base consonant, in the ordering
position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code>.</p></li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding Reph-position rules are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Reph-position rule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_MAIN</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_MAIN</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="reph-encoding">
<h4>Reph encoding<a class="headerlink" href="#reph-encoding" title="Permalink to this heading">¶</a></h4>
<p>“Reph” may be:</p>
<ul class="simple">
<li><p>requested explicitly, using the sequence “Ra,Halant,ZWJ”. This is
designated <code class="docutils literal notranslate"><span class="pre">REPH_MODE_EXPLICIT</span></code>.</p></li>
<li><p>Formed implicitly by the sequence “Ra,Halant” when used in certain positions
in a syllable. This is designated <code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code>. Because a
“Ra,Halant” does <em>not</em> form a “Reph” in <em>every</em> position in a
syllable, script-specific tests are required.</p></li>
<li><p>encoded as a separate codepoint. This codepoint is generally
called “Repha”, which distinguishes it from the “Reph”s formed by
other sequences. A “Repha” may need reordering based on script
specific rules, in which case <code class="docutils literal notranslate"><span class="pre">REPH_MODE_LOGICAL_REPHA</span></code> is
used. Alternatively, the script may not reorder “Repha”s at all,
in which case <code class="docutils literal notranslate"><span class="pre">REPH_MODE_VISUAL_REPHA</span></code> is used.</p></li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding Reph-encoding rules are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Reph-encoding rule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_LOGICAL_REPHA</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_EXPLICIT</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_MODE_EXPLICIT</span></code></p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Note: None of the specific scripts currently included in the “Indic”
group as it is enumerated in this document make use of the
<code class="docutils literal notranslate"><span class="pre">REPH_MODE_VISUAL_REPHA</span></code> encoding. However, <code class="docutils literal notranslate"><span class="pre">REPH_MODE_VISUAL_REPHA</span></code>
is used in the <a class="reference internal" href="opentype-shaping-khmer.html"><span class="doc std std-doc">Khmer</span></a> script.</p>
<p>Because Khmer shares many other characteristics and
conventions with the Indic group described by this document,
<code class="docutils literal notranslate"><span class="pre">REPH_MODE_VISUAL_REPHA</span></code> is included here for comparison.</p>
</div></blockquote>
</section>
<section id="below-base-forms">
<h4>Below-base forms<a class="headerlink" href="#below-base-forms" title="Permalink to this heading">¶</a></h4>
<p>Below-base consonant forms (the <code class="docutils literal notranslate"><span class="pre">blwf</span></code> feature) may be applied:</p>
<ul class="simple">
<li><p>Only to consonants after the base consonant or syllable base. This is designated
<code class="docutils literal notranslate"><span class="pre">BLWF_MODE_POST_ONLY</span></code>.</p></li>
<li><p>To consonants occurring before or after the base consonant or syllable base. This is
designated <code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code>.</p></li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding below-base–forms rules are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Below-base–forms rule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_POST_ONLY</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_POST_ONLY</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="left-side-matras">
<h4>Left-side matras<a class="headerlink" href="#left-side-matras" title="Permalink to this heading">¶</a></h4>
<p>All Indic scripts position left-side matras in the same
manner, in the ordering position <code class="docutils literal notranslate"><span class="pre">POS_PREBASE_MATRA</span></code>.</p>
</section>
<section id="right-side-matras">
<h4>Right-side matras<a class="headerlink" href="#right-side-matras" title="Permalink to this heading">¶</a></h4>
<p>Right-side matras may be positioned:</p>
<ul class="simple">
<li><p>immediately before the first subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the last subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the last post-base consonant, in the ordering
position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code>.</p></li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding right-side–matra positions are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Right-side–matra position</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><em>varies</em></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><em>varies</em></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Note: In most scripts, all right-side matras are positioned in the
same sort-order position. The Kannada and Telugu scripts, however,
feature more complex positioning rules for right-side matras, in
which different right-side matras must be sorted into different
positions. See the script-specific shaping documents for full
details.</p>
</div></blockquote>
</section>
<section id="above-base-matras">
<h4>Above-base matras<a class="headerlink" href="#above-base-matras" title="Permalink to this heading">¶</a></h4>
<p>Above-base matras may be positioned:</p>
<ul class="simple">
<li><p>immediately before the first subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the base consonant or syllable base, in the ordering position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_MAIN</span></code>.</p></li>
<li><p>immediately after the last subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the last post-base consonant, in the ordering
position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code>.</p></li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding above-base–matra positions are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Above-base–matra position</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><em>null</em></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><em>null</em></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_MAIN</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="below-base-matras">
<h4>Below-base matras<a class="headerlink" href="#below-base-matras" title="Permalink to this heading">¶</a></h4>
<p>Below-base matras may be positioned:</p>
<ul class="simple">
<li><p>immediately before the first subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the last subjoined (below-base) consonant, in
the ordering position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code>.</p></li>
<li><p>immediately after the last post-base consonant, in the ordering
position <code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code>.</p></li>
</ul>
<p>The scripts currently described in the “Indic” script group  and their
corresponding below-base–matra positions are summarized in the following
table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Below-base–matra position</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_POST</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_BEFORE_SUBJOINED</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">POS_AFTER_SUBJOINED</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="identifying-syllables-and-other-sequences">
<h3>1: Identifying syllables and other sequences<a class="headerlink" href="#identifying-syllables-and-other-sequences" title="Permalink to this heading">¶</a></h3>
<p>A syllable in an Indic script consists of a valid orthographic sequence
that may be followed by a “tail” of modifier signs.</p>
<p>The Nukta, Halant/Virama, and Anudatta marks can affect syllable
identification. All other signs are regarded as syllable modifier
signs, including those from the Vedic Extensions block.</p>
<p>Generally speaking, each syllable contains exactly one vowel
sound. Valid syllables may begin with either a consonant or an
independent vowel.</p>
<blockquote>
<div><p>Note: A consonant that is not accompanied by a dependent vowel (matra) sign
carries the script’s inherent vowel sound. This vowel sound is changed
by a dependent vowel (matra) sign following the consonant.</p>
</div></blockquote>
<p>Valid consonant-based syllables may include one or more additional
consonants that precede the base consonant. Each of these
other, pre-base consonants will be followed by the “Halant” mark, which
indicates that they carry no vowel. They affect pronunciation by
combining with the base consonant (e.g., “<em>str</em>”, “<em>pl</em>”) but they
do not add a vowel sound.</p>
<p>Some Indic scripts also include special consonants that can occur after the
base consonant or syllable base. These post-base consonants and final consonants will
also be separated from the base consonant or syllable base by a “Halant” mark; the
algorithm for correctly identifying the base consonant includes a test
to recognize these sequences and not mis-identify the base consonant.</p>
<p>In Indic scripts, the consonant “Ra” receives special treatment; in
many circumstances it is replaced by one of two combining mark-like forms.</p>
<ul class="simple">
<li><p>A “Ra,Halant” or “Ra,Halant,ZWJ” sequence at the beginning of a
syllable may be replaced with an above-base mark called “Reph”
(although script-specifics rules may negate this replacement if
the “Ra” is the only consonant in the syllable).</p></li>
<li><p>“Halant,Ra” sequences that occur elsewhere in the syllable may
take on a below-base form (called “Rakaar” in Devanagari and most
other scripts, and called “Raphala” in Bengali).</p></li>
</ul>
<p>In addition, some scripts reorder post-base “Ra”s to a pre-base
position. These re-ordering “Ra”s may take on a different form, but
they are letter-like rather than mark-like forms.</p>
<p>“Reph”, “Rakaar”, “Raphala”, and reordering “Ra” characters must be
reordered after the syllable-identification stage is complete.</p>
<blockquote>
<div><p>Note: Generally speaking, OpenType fonts will implement support for
any below-base, post-base, and pre-base-reordering consonant forms
by including the necessary substitution rules in their <code class="docutils literal notranslate"><span class="pre">blwf</span></code>,
<code class="docutils literal notranslate"><span class="pre">pstf</span></code>, and <code class="docutils literal notranslate"><span class="pre">pref</span></code> lookups in GSUB.</p>
<p>Consequently, whenever shaping engines need to determine whether or
not a given consonant can take on such a special form, the most
appropriate test is to check if the consonant is included in the
relevant GSUB lookup. Other implementations are possible, such as
maintaining static tables of consonants, but checking for GSUB
support ensures that the expected behavior is implemented in the
active font, and is therefore the most reliable approach.</p>
</div></blockquote>
<p>In addition to valid syllables, standalone sequences may occur, such
as when an isolated codepoint is shown in example text.</p>
<blockquote>
<div><p>Note: Foreign loanwords, when written in Indic scripts, may
not adhere to the syllable-formation rules described above. In
particular, it is not uncommon to encounter foreign loanwords that
contain a word-final suffix of consonants.</p>
<p>Nevertheless, such word-final suffixes will be correctly matched by
the regular expressions listed below. These loanwords are pronounced
different, which raises issues for potential readers, but the
character sequences do not affect the shaping process.</p>
</div></blockquote>
<p>Syllables should be identified by examining the run and matching
glyphs, based on their shaping class, using regular expressions.</p>
<p>The following general-purpose regular expressions can be
used to match Indic syllables.</p>
<p>The regular expressions utilize the shaping classes from the tables
above. For the purpose of syllable identification, more general
classes can be used, as defined in the following table. This
simplifies the resulting expressions.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="ge">_ra_</span>		= The consonant &quot;Ra&quot; 
<span class="ge">_consonant_</span>	= ( <span class="sb">`CONSONANT`</span> | <span class="sb">`CONSONANT_DEAD`</span> ) - <span class="ge">_ra_</span>
<span class="ge">_vowel_</span>		= <span class="sb">`VOWEL_INDEPENDENT`</span>
<span class="ge">_nukta_</span>	  	= <span class="sb">`NUKTA`</span>
<span class="ge">_halant_</span>	= <span class="sb">`VIRAMA`</span>
<span class="ge">_zwj_</span>		= <span class="sb">`JOINER`</span>
<span class="ge">_zwnj_</span>		= <span class="sb">`NON_JOINER`</span>
<span class="ge">_matra_</span>		= <span class="sb">`VOWEL_DEPENDENT`</span> | <span class="sb">`PURE_KILLER`</span>
<span class="ge">_syllablemodifier_</span>	= <span class="sb">`SYLLABLE_MODIFIER`</span> | <span class="sb">`BINDU`</span> | <span class="sb">`VISARGA`</span> | <span class="sb">`GEMINATION_MARK`</span>
<span class="ge">_vedicsign_</span>	= <span class="sb">`CANTILLATION`</span>
<span class="ge">_placeholder_</span>	= <span class="sb">`PLACEHOLDER`</span> | <span class="sb">`CONSONANT_PLACEHOLDER`</span>| <span class="sb">`NUMBER`</span> 
<span class="ge">_dottedcircle_</span>	= <span class="sb">`DOTTED_CIRCLE`</span>
<span class="ge">_repha_</span>		= <span class="sb">`CONSONANT_PRE_REPHA`</span>
<span class="ge">_consonantmedial_</span>	= <span class="sb">`CONSONANT_MEDIAL`</span>
<span class="ge">_symbol_</span>	= <span class="sb">`SYMBOL`</span> | <span class="sb">`AVAGRAHA`</span>
<span class="ge">_consonantwithstacker_</span>	= <span class="sb">`CONSONANT_WITH_STACKER`</span>
<span class="ge">_other_</span>		= <span class="sb">`OTHER`</span> | <span class="sb">`MODIFYING_LETTER`</span>
</pre></div>
</div>
<blockquote>
<div><p>Note: the <em>ra</em> identification class is mutually exclusive with
the <em>consonant</em> class. The union of the <em>consonant</em> and <em>ra</em> classes
is used in the regular expression elements below in order to
correctly identify “Ra” characters that do not trigger “Reph” or
“Rakaar” shaping behavior.</p>
<p>Note, also, that the cantillation mark “combining Ra” in the
Devanagari Extended block does <em>not</em> belong to the <em>ra</em>
identification class, and that the other “combining consonant”
cantillation marks in the Devanagari Extended block do not belong to
the <em>consonant</em> identification class.</p>
</div></blockquote>
<blockquote>
<div><p>Note: The <em>placeholder</em> identification class includes codepoints
that are often used in place of vowels or consonants when a document
needs to display a matra, mark, or special form in isolation or
in another context beyond a standard syllable. Examples of
<em>placeholder</em> codepoints include hyphens and non-breaking
spaces. Sequences that utilize this approach should be identified as
“standalone” syllables.</p>
<p>The <em>placeholder</em> identification class also includes numerals, which
are commonly used as word substitutes within normal text. Examples
include ordinals (e.g., “4th”).</p>
</div></blockquote>
<blockquote>
<div><p>Note: The <em>other</em> identification class includes codepoints that
do not interact with adjacent characters for shaping purposes. Even
though some of these codepoints (such as <code class="docutils literal notranslate"><span class="pre">MODIFYING_LETTER</span></code>) can
occur within words, they evoke no behavior from the shaping
engine and do not factor into the regular expressions that
follow. Therefore, the shaping engine may choose to ignore them
during syllable identification; they are listed here for completeness.</p>
</div></blockquote>
<p>These identification classes form the bases of the following regular
expression elements:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>C	= <span class="ge">_consonant_</span> | <span class="ge">_ra_</span>
Z	= <span class="ge">_zwj_</span> | <span class="ge">_zwnj_</span>
REPH	= (<span class="ge">_ra_</span> <span class="ge">_halant_</span>) | <span class="ge">_repha_</span>
CN		= C <span class="ge">_zwj_</span>? <span class="ge">_nukta_</span>?
FORCED_RAKAR	= <span class="ge">_zwj_</span> <span class="ge">_halant_</span> <span class="ge">_zwj_</span> <span class="ge">_ra_</span>
S	= <span class="ge">_symbol_</span> <span class="ge">_nukta_</span>?
MATRA_GROUP	= Z{0,3} <span class="ge">_matra_</span> <span class="ge">_nukta_</span>? (<span class="ge">_halant_</span> | FORCED_RAKAR)?
SYLLABLE_TAIL	= (Z? <span class="ge">_syllablemodifier_</span> <span class="ge">_syllablemodifier_</span>? <span class="ge">_zwnj_</span>?)? <span class="ge">_vedicsign_</span>{0,3}
HALANT_GROUP	= Z? <span class="ge">_halant_</span> (<span class="ge">_zwj_</span> <span class="ge">_nukta_</span>?)?
FINAL_HALANT_GROUP	= HALANT_GROUP | (<span class="ge">_halant_</span> <span class="ge">_zwnj_</span>)
MEDIAL_GROUP	= <span class="ge">_consonantmedial_</span>?
HALANT_OR_MATRA_GROUP	= FINAL_HALANT_GROUP | MATRA_GROUP*)
</pre></div>
</div>
<blockquote>
<div><p>Note: Practically speaking, shaping engines are highly unlikely to
encounter more than 4 sequential <code class="docutils literal notranslate"><span class="pre">(MATRA_GROUP)</span></code>
instances in any real-word syllables. Thus, implementations may
choose to limit occurrences by limiting the above expressions to a
finite length, such as <code class="docutils literal notranslate"><span class="pre">(MATRA_GROUP){0,4}</span></code> .</p>
</div></blockquote>
<p>Using the above elements, the following regular expressions define the
possible syllable types:</p>
<p>A consonant-based syllable will match the expression:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>(<span class="ge">_repha_</span>|<span class="ge">_consonantwithstacker_</span>)? (CN HALANT_GROUP)* CN MEDIAL_GROUP HALANT_OR_MATRA_GROUP SYLLABLE_TAIL
</pre></div>
</div>
<blockquote>
<div><p>Note: Practically speaking, shaping engines are highly unlikely to
encounter more than 4 sequential <code class="docutils literal notranslate"><span class="pre">(CN</span> <span class="pre">HALANT_GROUP)</span></code>
instances in any real-word syllables. Thus, implementations may
choose to limit occurrences by limiting the above expressions to a
finite length, such as <code class="docutils literal notranslate"><span class="pre">(CN</span> <span class="pre">HALANT_GROUP){0,4}</span></code> .</p>
</div></blockquote>
<p>A vowel-based syllable will match the expression:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>REPH? <span class="ge">_vowel_</span> <span class="ge">_nukta_</span>? (<span class="ge">_zwj_</span> | (HALANT_GROUP CN)* MEDIAL_GROUP HALANT_OR_MATRA_GROUP SYLLABLE_TAIL)
</pre></div>
</div>
<blockquote>
<div><p>Note: Practically speaking, shaping engines are highly unlikely to
encounter more than 4 sequential <code class="docutils literal notranslate"><span class="pre">(HALANT_GROUP</span> <span class="pre">CN)</span></code>
instances in any real-word syllables. Thus, implementations may
choose to limit occurrences by limiting the above expressions to a
finite length, such as <code class="docutils literal notranslate"><span class="pre">(HALANT_GROUP</span> <span class="pre">CN){0,4}</span></code> .</p>
</div></blockquote>
<p>A standalone syllable will match the expression:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>((_repha_|_consonantwithstacker_)? <span class="ge">_placeholder_</span> | REPH? <span class="ge">_dottedcircle_</span>) <span class="ge">_nukta_</span>? (HALANT_GROUP CN)* MEDIAL_GROUP HALANT_OR_MATRA_GROUP SYLLABLE_TAIL
</pre></div>
</div>
<blockquote>
<div><p>Note: Practically speaking, shaping engines are highly unlikely to
encounter more than 4 sequential <code class="docutils literal notranslate"><span class="pre">(HALANT_GROUP</span> <span class="pre">CN)</span></code>
instances in any real-word syllables. Thus, implementations may
choose to limit occurrences by limiting the above expressions to a
finite length, such as <code class="docutils literal notranslate"><span class="pre">(HALANT_GROUP</span> <span class="pre">CN){0,4}</span></code> .</p>
</div></blockquote>
<blockquote>
<div><p>Note: Although they are labeled as “standalone syllables” here,
many sequences that match the standalone regular expression above
are instances where a document needs to display a matra, combining
mark, or special form in isolation. Such sequences might not have
any significance with regard to the definition of syllables used in
the language or orthography of the text.</p>
</div></blockquote>
<p>A symbol-based syllable will match the expression:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>S SYLLABLE_TAIL
</pre></div>
</div>
<p>A broken syllable will match the expression:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>REPH? <span class="ge">_nukta_</span>? (HALANT_GROUP CN)* MEDIAL_GROUP HALANT_OR_MATRA_GROUP SYLLABLE_TAIL
</pre></div>
</div>
<blockquote>
<div><p>Note: Practically speaking, shaping engines are highly unlikely to
encounter more than 4 sequential <code class="docutils literal notranslate"><span class="pre">(HALANT_GROUP</span> <span class="pre">CN)</span></code>
instances in any real-word syllables. Thus, implementations may
choose to limit occurrences by limiting the above expressions to a
finite length, such as <code class="docutils literal notranslate"><span class="pre">(HALANT_GROUP</span> <span class="pre">CN){0,4}</span></code> .</p>
</div></blockquote>
<p>The primary problem involved in shaping broken syllables is the lack
of a syllable base (either a base consonant or an independent
vowel). Without a syllable base, the shaping engine cannot perform
GPOS positioning and other contextual operations that are required
later in the shaping process.</p>
<p>To make up for this limitation, shaping engines should insert a
dotted-circle placeholder (<code class="docutils literal notranslate"><span class="pre">U+25CC</span></code>) character into the text stream
where the missing syllable base was expected to occur. This
placeholder allows the shaping process to proceed on a best-effort
basis at handling the broken-syllable sequence, but making guarantees
about the orthographic correctness or preferred appearance of the
final result is out of scope for this document.</p>
<p>Shaping engines can perform this dotted-circle insertion at any point
after the broken syllable has been recognized and before GSUB features
are applied. However, the best results will likely be attained by
performing the insertion immediately, before proceeding to
stage 2. This will enable the maximum number of GSUB and GPOS features
in the active font to be correctly applied to the text run by ensuring
that all reordering, tagging, and sorting algorithms are executed as
usual.</p>
<blockquote>
<div><p>Note: In software stacks where other text-handling operations, such
as Unicode normalization and localization, are performed before the
text run is passed to the shaping engine, there is a potential for
the dotted-circle insertion to cause unexpected effects.</p>
<p>For example, if a <code class="docutils literal notranslate"><span class="pre">ccmp</span></code> or <code class="docutils literal notranslate"><span class="pre">locl</span></code> feature substitutes the default
dotted-circle placeholder glyph with a variant glyph of a different
size or weight for the (<code class="docutils literal notranslate"><span class="pre">U+25CC</span></code>) codepoint, then any shaping engine
which relies on another software component to handle that
functionality must take additional care to ensure consistency.</p>
</div></blockquote>
<p>The expressions above use state-machine syntax from the Ragel
state-machine compiler. The operators represent:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>a* = zero or more copies of a
b+ = one or more copies of b
c? = optional instance of c
d{n} = exactly n copies of d
d{,n} = zero to n copies of d
d{n,} = n or more copies of d
d{n,m} = n to m copies of d
!e = not e
^f = character-level not f
g.h = concatenation of g and h
i|j = i or j
( ) = grouping of expression elements
</pre></div>
</div>
<blockquote>
<div><p>Note: “standalone” syllables can be used to display examples of
letters, marks, and other characters without requiring full
syllables or words.</p>
</div></blockquote>
<p>After the syllables have been identified, each of the subsequent
shaping stages occurs on a per-syllable basis.</p>
</section>
<section id="initial-reordering">
<h3>2: Initial reordering<a class="headerlink" href="#initial-reordering" title="Permalink to this heading">¶</a></h3>
<p>The initial reordering stage is used to relocate glyphs from the
phonetic order in which they occur in a run of text to the
orthographic order in which they are presented visually.</p>
<p>This may mean moving dependent-vowel (matra) glyphs, “Ra,Halant”
sequences, and other consonants that take special
treatment in some circumstances.</p>
<p>These reordering moves are mandatory. The final-reordering stage
may make additional moves, depending on the text and on the features
implemented in the active font.</p>
<p>The syllable should be processed by tagging each glyph with its
intended position based on its ordering category. After all glyphs
have been tagged, the entire syllable should be sorted in stable order,
so that glyphs of the same ordering category remain in the same
relative position with respect to each other.</p>
<p>The final sort order of the ordering categories should be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>POS_RA_TO_BECOME_REPH
POS_PREBASE_MATRA
POS_PREBASE_CONSONANT

POS_SYLLABLE_BASE
POS_AFTER_MAIN

POS_ABOVEBASE_CONSONANT

POS_BEFORE_SUBJOINED
POS_BELOWBASE_CONSONANT
POS_AFTER_SUBJOINED

POS_BEFORE_POST
POS_POSTBASE_CONSONANT
POS_AFTER_POST

POS_FINAL_CONSONANT
POS_SMVD
</pre></div>
</div>
<p>This sort order enumerates all of the possible final positions to
which a codepoint might be reordered, across all of the Indic
scripts. Not every position will be utilized in every script.</p>
<p>Additional information about the ordering positions is available in
the <a class="reference internal" href="#sort-ordering"><span class="std std-doc">sort ordering</span></a> section of this document.</p>
<section id="id1">
<h4>2.1: Base consonant<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h4>
<p>The first step is to determine the base consonant of the syllable, if
there is one, and tag it as <code class="docutils literal notranslate"><span class="pre">POS_SYLLABLE_BASE</span></code>.</p>
<p>The algorithm used to find the base consonant varies according to the
base-consonant shaping characteristic of the script.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code> scripts, the first consonant of the syllable is
the base consonant.</p>
<blockquote>
<div><p>Note: None of the specific scripts currently included in the “Indic”
group as it is enumerated in this document make use of the
<code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code> base-consonant rule. However, the <code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code>
rule is employed by several Brahmi-derived scripts also used in the
region, including both <a class="reference internal" href="opentype-shaping-myanmar.html"><span class="doc std std-doc">Myanmar</span></a> and
<a class="reference internal" href="opentype-shaping-khmer.html"><span class="doc std std-doc">Khmer</span></a>.</p>
<p>Because these scripts share many other characteristics and
conventions with the Indic group described by this document,
<code class="docutils literal notranslate"><span class="pre">BASE_POS_FIRST</span></code> is included here for comparison.</p>
</div></blockquote>
<p>For <code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST</span></code> scripts, the base consonant is the last consonant
in the syllable, excluding all consonants that will take on special
post-base, final, or below-base forms, and excluding all pre-base
reordering “Ra”s. For a detailed explanation of the search algorithm
employed, see the page for each specific script.</p>
<p>For Sinhala, which uses <code class="docutils literal notranslate"><span class="pre">BASE_POS_LAST_SINHALA</span></code>, the base consonant is
the last consonant that is not preceded by a zero-width joiner
(“ZWJ”).</p>
<p>While performing the base-consonant search, shaping engines may
also encounter special-form consonants, including below-base
consonants and post-base consonants. Each of these special-form
consonants must also be tagged (<code class="docutils literal notranslate"><span class="pre">POS_BELOWBASE_CONSONANT</span></code>,
<code class="docutils literal notranslate"><span class="pre">POS_POSTBASE_CONSONANT</span></code>, respectively).</p>
<p>Any pre-base-reordering consonant (such as a pre-base-reodering “Ra”)
encountered during the base-consonant search must be tagged
<code class="docutils literal notranslate"><span class="pre">POS_POSTBASE_CONSONANT</span></code>.</p>
<blockquote>
<div><p>Note: Shaping engines may choose any method to identify consonants that
have below-base, post-base, or pre-base-reordering forms while
executing the above algorithm. For example, one implementation may
choose to maintain a static table of special-form consonants to
compare against the text run. Another implementation might examine
the active font to see if it includes a <code class="docutils literal notranslate"><span class="pre">blwf</span></code>, <code class="docutils literal notranslate"><span class="pre">pstf</span></code>, or <code class="docutils literal notranslate"><span class="pre">pref</span></code>
lookup in the GSUB table that affects the consonants encountered in
the syllable.</p>
<p>However, checking for GSUB support ensures that the expected
behavior is implemented in the active font, and is therefore the
most reliable approach.</p>
</div></blockquote>
</section>
<section id="matra-decomposition">
<h4>2.2: Matra decomposition<a class="headerlink" href="#matra-decomposition" title="Permalink to this heading">¶</a></h4>
<p>Second, any two-part or three-part dependent vowels (matras) must be decomposed
into their component parts.</p>
<p>Because this decomposition is a character-level operation, the shaping
engine may choose to perform it earlier, such as during an initial
Unicode-normalization stage. However, all such decompositions must be
completed before the shaping engine begins step three, below.</p>
</section>
<section id="tag-decomposed-matras">
<h4>2.3: Tag decomposed matras<a class="headerlink" href="#tag-decomposed-matras" title="Permalink to this heading">¶</a></h4>
<p>Third, all dependent-vowel (matra) signs must be tagged with
their final position.</p>
<p>Single-part matras can be tagged with the appropriate sort-ordering
position based on the ordering position of the script’s specific
script-shaping characteristics.</p>
<p>In most cases, all matras of the same Mark-positioning subclass (such
as <code class="docutils literal notranslate"><span class="pre">LEFT_POSITION</span></code>) in a particular script are tagged with the same
final position (such as <code class="docutils literal notranslate"><span class="pre">POS_PREBASE_MATRA</span></code>).</p>
<p>Some scripts, however, include matras that must be tagged according to
more involved rule sets. In the set of Indic scripts described here,
this includes <a class="reference internal" href="opentype-shaping-kannada.html"><span class="doc std std-doc">Kannada</span></a> and
<a class="reference internal" href="opentype-shaping-telugu.html"><span class="doc std std-doc">Telugu</span></a>. See the individual
script-shaping document of each script to find a complete description
of the applicable matra-tagging rules.</p>
<blockquote>
<div><p>Note: The shaping engine may, as an alternative, choose to perform
this tagging earlier, such as during an initial Unicode-normalization
stage.</p>
<p>Matras that resulted from the preceding decomposition step, however,
may not have been tagged when they were decomposed. If not, they must
be tagged for reordering before proceeding to the next step.</p>
</div></blockquote>
</section>
<section id="adjacent-marks">
<h4>2.4: Adjacent marks<a class="headerlink" href="#adjacent-marks" title="Permalink to this heading">¶</a></h4>
<p>Fourth, any subsequences of marks that include a “Nukta” and a
“Halant” or Vedic sign must be reordered so that the “Nukta” appears
first.</p>
<p>This means that the subsequence “Halant,Nukta” is reordered to
“Nukta,Halant” and that the subsequence “<em>Vedic_sign</em>,Nukta” is
reordered to “Nukta,_Vedic_sign”.</p>
<p>For subsequences of affected marks that are longer than two, the
reordering operation must be repeated until the “Nukta” is the first
character in the subsequence. No other marks in the subsequence
should be reordered.</p>
<p>This order is canonical in Unicode and is required so that
“<em>consonant</em>,Nukta” substitution rules from GSUB will be correctly
matched later in the shaping process.</p>
</section>
<section id="pre-base-consonants">
<h4>2.5: Pre-base consonants<a class="headerlink" href="#pre-base-consonants" title="Permalink to this heading">¶</a></h4>
<p>Fifth, consonants that occur before the syllable base must be tagged
with <code class="docutils literal notranslate"><span class="pre">POS_PREBASE_CONSONANT</span></code>. Excluding initial “Ra,Halant” sequences
that will become “Reph”s:</p>
<ul class="simple">
<li><p>If the consonant has a below-base form, tag it as
<code class="docutils literal notranslate"><span class="pre">POS_BELOWBASE_CONSONANT</span></code>.</p></li>
<li><p>Otherwise, tag it as <code class="docutils literal notranslate"><span class="pre">POS_PREBASE_CONSONANT</span></code>.</p></li>
</ul>
<blockquote>
<div><p>Note: Shaping engines may choose any method to identify consonants that
have below-base, post-base, or pre-base-reordering forms while
executing the above algorithm. For example, one implementation may
choose to maintain a static table of special-form consonants to
compare against the text run. Another implementation might examine
the active font to see if it includes a <code class="docutils literal notranslate"><span class="pre">blwf</span></code>, <code class="docutils literal notranslate"><span class="pre">pstf</span></code>, or <code class="docutils literal notranslate"><span class="pre">pref</span></code>
lookup in the GSUB table that affects the consonants encountered in
the syllable.</p>
<p>However, checking for GSUB support ensures that the expected
behavior is implemented in the active font, and is therefore the
most reliable approach.</p>
</div></blockquote>
</section>
<section id="reph">
<h4>2.6: Reph<a class="headerlink" href="#reph" title="Permalink to this heading">¶</a></h4>
<p>Sixth, initial “Ra,Halant” (in <code class="docutils literal notranslate"><span class="pre">REPH_MODE_IMPLICIT</span></code> scripts) or
“Ra,Halant,ZWJ” (in <code class="docutils literal notranslate"><span class="pre">REPH_MODE_EXPLICIT</span></code> scripts) sequences that will
become “Reph”s must be tagged with <code class="docutils literal notranslate"><span class="pre">POS_RA_TO_BECOME_REPH</span></code>.</p>
</section>
<section id="post-base-consonants">
<h4>2.7: Post-base consonants<a class="headerlink" href="#post-base-consonants" title="Permalink to this heading">¶</a></h4>
<p>Seventh, any non-base consonants that occur after a dependent vowel
(matra) sign must be tagged with <code class="docutils literal notranslate"><span class="pre">POS_POSTBASE_CONSONANT</span></code>. Such
consonants will either be followed by a “Halant” glyph or will be in
the <code class="docutils literal notranslate"><span class="pre">CONSONANT_DEAD</span></code> shaping class.</p>
  <!--- Double check: should this be "_Consonant_,Halant" instead of
        "Halant,_Consonant_"? --->
</section>
<section id="mark-tagging">
<h4>2.8: Mark tagging<a class="headerlink" href="#mark-tagging" title="Permalink to this heading">¶</a></h4>
<p>Eighth, all marks must be tagged.</p>
<blockquote>
<div><p>Note: In this step, joiner and non-joiner characters must also be
tagged according to the same rules given for marks, even though
these characters are not categorized as marks in Unicode.</p>
</div></blockquote>
<p>Marks in the <code class="docutils literal notranslate"><span class="pre">BINDU</span></code>, <code class="docutils literal notranslate"><span class="pre">VISARGA</span></code>, <code class="docutils literal notranslate"><span class="pre">AVAGRAHA</span></code>, <code class="docutils literal notranslate"><span class="pre">CANTILLATION</span></code>,
<code class="docutils literal notranslate"><span class="pre">SYLLABLE_MODIFIER</span></code>, <code class="docutils literal notranslate"><span class="pre">GEMINATION_MARK</span></code>, and <code class="docutils literal notranslate"><span class="pre">SYMBOL</span></code> categories should
be tagged with <code class="docutils literal notranslate"><span class="pre">POS_SMVD</span></code>.</p>
<p>All “Nukta”s must be tagged with the same positioning tag as the
preceding consonant, independent vowel, placeholder, or dotted circle.</p>
<p>All remaining marks (not in the <code class="docutils literal notranslate"><span class="pre">POS_SMVD</span></code> category and not “Nukta”s)
must be tagged with the same positioning tag as the closest non-mark
character the mark has affinity with, so that they move together
during the sorting step.</p>
<p>There are two possible cases: those marks before the syllable base
and those marks after the syllable base. In addition, an exception is
made for “Halant” marks that follow a left-side (pre-base) matra.</p>
<ol class="arabic">
<li><p>Initially, all remaining marks should be tagged with the same
positioning tag as the closest preceding consonant.</p></li>
<li><p>For each consonant after the syllable base (such as post-base
consonants, below-base consonants, or final consonants), all
remaining marks located between that current consonant and any
previous consonant should be tagged with the same positioning tag as
the current (later) consonant.</p>
<p>In other words, all consonants preceding the syllable base “own” the
marks that follow them, while all consonants after the syllable base
“own” the marks that come before them. When a syllable does not have
any consonants after the syllable base, the syllable base should
“own” all the marks that follow it.</p>
</li>
<li><p>Finally, “Halant” marks that follow a left-side dependent vowel
(matra) should <em>not</em> be tagged with the left-side matra’s
positioning tag. Instead, the “Halant” should be tagged with the
positioning tag of the non-mark character preceding the left-side
matra. This prevents the “Halant” mark from being moved with the
left-side matra when the syllable is sorted.</p></li>
</ol>
<!--- HarfBuzz also tags everything between a post-base consonant or -->
<!--matra and another post-base consonant as belonging to the latter -->
<!--post-base consonant. --->
</section>
<section id="sort-syllable">
<h4>2.9: Sort syllable<a class="headerlink" href="#sort-syllable" title="Permalink to this heading">¶</a></h4>
<p>With these steps completed, the syllable can be sorted into the final
sort order as listed at the beginning of stage 2.</p>
<p>The glyphs in the syllable should be sorted in stable order,
so that glyphs of the same ordering category remain in the same
relative position with respect to each other.</p>
</section>
<section id="flag-sequences-for-possible-feature-applications">
<h4>2.10: Flag sequences for possible feature applications<a class="headerlink" href="#flag-sequences-for-possible-feature-applications" title="Permalink to this heading">¶</a></h4>
<p>With the initial reordering complete, those glyphs in the syllable that
may have GSUB or GPOS features applied in stages 3, 5, and 6 should be
flagged for each potential feature.</p>
<p>This flagging is preliminary; the set of potential features varies
between different scripts and which features are supported varies
between fonts. It is also possible that the application of
one feature on a glyph sequence will perform a substitution that makes
a later feature no longer applicable to the updated sequence.</p>
<p>Consequently, the flagging must be completed before shaping proceeds
to the stages during which features are applied.</p>
<p>Some shaping features, such as <code class="docutils literal notranslate"><span class="pre">locl</span></code>, can potentially apply to any
glyphs. Therefore it is not necessary to maintain a separate flag for
these features in the bitmask (or other data structure) used to track
the flags – although shaping engines may do so if desired.</p>
<p>The sequences to flag are summarized in the list below; a full
description of each feature’s function and interpretation is provided
in GSUB and GPOS application stages that follow.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nukt</span></code> should match “<em>Consonant</em>,Nukta” sequences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">akhn</span></code> should match “Ka,Halant,Ssa” and “Ja,Halant,Nya”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rphf</span></code> should match initial “Ra,Halant” sequences but <em>not</em> match
initial “Ra,Halant,ZWJ” sequences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blwf</span></code> should match “Halant,Ra”, “Halant,Ha”, and “Halant,Va” in
post-base positions and “Ra,Halant”, “Ha,Halant”, and
“Va,Halant” in non-initial pre-base positions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">half</span></code> should match “<em>Consonant</em>,Halant” in pre-base position but
<em>not</em> match “Ra,Halant” sequences flagged for <code class="docutils literal notranslate"><span class="pre">rphf</span></code> and
<em>not</em> match “<em>Consonant</em>,Halant,ZWNJ,<em>Consonant</em>” sequences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pstf</span></code> should match initial “Halant,Ya” in post-base position</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vatu</span></code> should match “<em>Consonant</em>,Halant,Ra”,
“<em>Consonant</em>,Halant,Ha”, and “<em>Consonant</em>,Halant,Va”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cjct</span></code> should match “<em>Consonant</em>,Halant,<em>Consonant</em>” but <em>not</em>
match “<em>Consonant</em>,Halant,ZWJ,<em>Consonant</em>” or
“<em>Consonant</em>,Halant,ZWNJ,<em>Consonant</em>”</p></li>
</ul>
</section>
</section>
<section id="applying-the-basic-substitution-features-from-gsub">
<h3>3: Applying the basic substitution features from GSUB<a class="headerlink" href="#applying-the-basic-substitution-features-from-gsub" title="Permalink to this heading">¶</a></h3>
<p>The basic-substitution stage applies mandatory substitution features
using the rules in the font’s GSUB table. In preparation for this
stage, glyph sequences should be flagged for possible application
of GSUB features in stage 2, step 10.</p>
<p>The order in which these substitutions must be performed is fixed for
all Indic scripts:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>locl
nukt
akhn
rphf 
rkrf 
pref 
blwf 
abvf 
half
pstf
vatu
cjct
cfar
</pre></div>
</div>
<p>Not every feature is used in every script. See the individual script
pages for further script-specific information.</p>
<blockquote>
<div><p>Note: Strictly speaking, the use of localized-form substitutions is
not part of the shaping process, but of the localization process,
and could take place at an earlier point while handling the text
run. However, shaping engines are expected to complete the
application of the <code class="docutils literal notranslate"><span class="pre">locl</span></code> feature before applying the subsequent
GSUB substitutions in the following steps.</p>
</div></blockquote>
</section>
<section id="final-reordering">
<h3>4: Final reordering<a class="headerlink" href="#final-reordering" title="Permalink to this heading">¶</a></h3>
<p>The final reordering stage repositions marks, dependent-vowel (matra)
signs, and “Reph” glyphs to the appropriate location with respect to
the base consonant or syllable base. Because multiple substitutions
may have occurred during the application of the basic-shaping features
in the preceding stage, these repositioning moves could not be
performed during the initial reordering stage.</p>
<p>Like the initial reordering stage, the steps involved in this stage
occur on a per-syllable basis.</p>
<!--- Check that classifications have not been mangled. If the -->
<!--character is a Halant AND a ligature was formed AND a multiple
substitution was performed, restore the classification to VIRAMA
because it was almost certainly lost in the preceding GSUB stage.
--->
<section id="id2">
<h4>4.1: Base consonant<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h4>
<p>The final reordering stage, like the initial reordering stage, begins
with determining the syllable base of each syllable, following the
same algorithm used in stage 2, step 1.</p>
<p>In a syllable that begins with an independent vowel, the independent
vowel will always serve as the syllable base. In a standalone sequence or
other syllable that begins with a placeholder or a dotted circle, the
placeholder or dotted circle will always serve as the syllable base.</p>
<p>In a syllable that begins with a consonant, the shaping engine must
repeat the base-consonant search algorithm used in stage 2, step 1.</p>
<p>The codepoint of the underlying base consonant or syllable base will
not change between the search performed in stage 2, step 1, and the
search repeated here. However, the application of GSUB shaping
features in stage 3 means that several ligation and many-to-one
substitutions may have taken place. The final glyph produced by that
process may, therefore, be a conjunct or ligature form — in most
cases, such a glyph will not have an assigned Unicode codepoint.</p>
</section>
<section id="pre-base-matras">
<h4>4.2: Pre-base matras<a class="headerlink" href="#pre-base-matras" title="Permalink to this heading">¶</a></h4>
<p>Pre-base dependent vowels (matras) that were reordered during the
initial reordering stage must be moved to their final position. This
position is defined as:</p>
<ul class="simple">
<li><p>after the last standalone “Halant” glyph that comes after the
matra’s starting position and also comes before the main
consonant.</p></li>
<li><p>If a zero-width joiner follows this last standalone “Halant”, the
final matra position is moved to after the joiner.</p></li>
</ul>
<p>This means that the matra will move to the right of all explicit
“<em>Consonant</em>,Halant” subsequences, but will stop to the left of the base
consonant or syllable base, all conjuncts or ligatures that contain
the base consonant or syllable base, and all half forms.</p>
<blockquote>
<div><p>Note: OpenType and Unicode both state that if the syllable includes
a ZWJ immediately after the last “Halant”, then the final matra
position should be after the ZWJ.</p>
<p>However, there are several test sequences indicating that
Microsoft’s Uniscribe shaping engine did not follow this rule (in,
at least, Devanagari and Bengali text), and in these circumstances
Uniscribe instead makes the final matra position before the final
“Consonant,Halant,ZWJ”.</p>
<p>Subsequently, the HarfBuzz shaping engine has also followed the same
pattern. If other shaping engine implementations prefer to maintain
maximum compatibility with Uniscribe and HarfBuzz, then they should
also follow suit.</p>
</div></blockquote>
<blockquote>
<div><p>Note: The Microsoft script-development specifications for OpenType
shaping also state that if a zero-width non-joiner follows the last
standalone “Halant”, the final matra position is moved to after the
non-joiner. However, it is unneccessary to test for this condition,
because a “Halant,ZWNJ” subsequence is, by definition, the end of a
syllable. Consequently, a “Halant,ZWNJ” cannot be followed by a
pre-base dependent vowel.</p>
</div></blockquote>
</section>
<section id="id3">
<h4>4.3: Reph<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>“Reph” must be moved from the beginning of the syllable to its final
position. The correct final position depends on the script’s
Reph-position shaping characteristic, and is conditional upon the
presence or absence of certain characters (such as post-base
consonants or “matra,Halant” sequences) in the syllable.</p>
<p>The full algorithm for determining the final Reph position has seven steps.</p>
<p>(a) If the script uses Reph-position rule <code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code>, jump
immediately to step (e). Otherwise, proceed to step (b).</p>
<p>(b) Find the first explicit “Halant” between the syllable base
consonant and the first post-Reph consonant. If there is a ZWJ or ZWNJ
following this “Halant”, move the “Reph” to a position immediately
after the ZWJ or ZWNJ, then proceed to step (mH). Otherwise, move the
“Reph” to a position immediately after the “Halant”, then proceed to
step (mH). If no such explicit “Halant” is found, proceed to step
(c).</p>
<p>(c) If the script uses Reph-position rule <code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_MAIN</span></code>, find
the first consonant not ligated with the syllable base, and that is
not a potential pre-base reordering “Ra”. If such a consonant is
found, move the “Reph” to a position immediately after the
consonant, then proceed to step (mH). If no such consonant is found,
proceed to step (d). If the script uses a different Reph-position
rule, proceed to step (d).</p>
<p>(d) If the script uses Reph-position rule <code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_POST</span></code>, find
the first post-base consonant not ligated with the syllable base. If
such a consonant is found, move the “Reph” to a position immediately
before the consonant, then proceed to step (mH). If no such consonant
is found, proceed to step (e). If the script uses a different
Reph-position rule, proceed to step (e).</p>
<p>(e) Move the “Reph” to a position immediately before the first
post-base matra, syllable modifier sign or Vedic sign that has a
reordering class after the intended Reph position in the syllable sort
order (as listed in <a class="reference internal" href="#initial-reordering"><span class="std std-doc">stage 2</span></a>). This will be
the final “Reph” position. , then proceed to step (mH). If no such
matra or sign is found, proceed to step (f).</p>
<p>(f) Move the “Reph” to the end of the syllable.</p>
<p>(mH) Finally, if the “Reph” position arrived at in the preceding steps
is immediately after a “matra,Halant” sequence, move the “Reph” so
that it is before the “Halant”.</p>
<p>Taking the Reph-position–rule conditionals in the above algorithm into
account, the position-finding steps that may be executed in each
script are summarized in the following table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Script</p></th>
<th class="head text-left"><p>Reph-position rule</p></th>
<th class="head text-left"><p>a</p></th>
<th class="head text-left"><p>b</p></th>
<th class="head text-left"><p>c</p></th>
<th class="head text-left"><p>d</p></th>
<th class="head text-left"><p>e</p></th>
<th class="head text-left"><p>f</p></th>
<th class="head text-left"><p>mH</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Devanagari</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_POST</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Bengali</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_SUBJOINED</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Gujarati</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_POST</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Gurmukhi</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_BEFORE_SUBJOINED</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Kannada</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Malayalam</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_MAIN</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Oriya</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_MAIN</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Tamil</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Telugu</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_POST</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Sinhala</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">REPH_POS_AFTER_MAIN</span></code></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
<td class="text-left"><p>•</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pre-base-reordering-consonants">
<h4>4.4: Pre-base reordering consonants<a class="headerlink" href="#pre-base-reordering-consonants" title="Permalink to this heading">¶</a></h4>
<p>Any pre-base-reordering consonants must be moved to immediately before
the base consonant or syllable base.</p>
</section>
<section id="initial-matras">
<h4>4.5: Initial matras<a class="headerlink" href="#initial-matras" title="Permalink to this heading">¶</a></h4>
<p>Any left-side dependent vowels (matras) that are at the start of a
word must be flagged for potential substitution by the <code class="docutils literal notranslate"><span class="pre">init</span></code> feature
of GSUB.</p>
<blockquote>
<div><p>Note: The <code class="docutils literal notranslate"><span class="pre">init</span></code> feature for word-initial dependent vowels (matras)
is defined only for Bengali and should not be expected in fonts for
any other scripts. Therefore, this step will involve no work when
processing non-<code class="docutils literal notranslate"><span class="pre">&lt;bng2&gt;</span></code> text.</p>
</div></blockquote>
</section>
</section>
<section id="applying-all-remaining-substitution-features-from-gsub">
<h3>5: Applying all remaining substitution features from GSUB<a class="headerlink" href="#applying-all-remaining-substitution-features-from-gsub" title="Permalink to this heading">¶</a></h3>
<p>In this stage, the remaining substitution features from the GSUB table
are applied. In preparation for this stage, glyph sequences should be
flagged for possible application of GSUB features in stage 2,
step 10.</p>
<p>The order in which these features are applied is not canonical; they
should be applied in the order in which they appear in the GSUB table
in the font.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>init
pres
abvs
blws
psts
haln
</pre></div>
</div>
</section>
<section id="applying-remaining-positioning-features-from-gpos">
<h3>6: Applying remaining positioning features from GPOS<a class="headerlink" href="#applying-remaining-positioning-features-from-gpos" title="Permalink to this heading">¶</a></h3>
<p>In this stage, mark positioning, kerning, and other GPOS features are
applied.</p>
<p>As with the preceding stage, the order in which these features are
applied is not canonical; they should be applied in the order in which
they appear in the GPOS table in the font.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    dist
    abvm
    blwm
</pre></div>
</div>
</section>
</section>
<section id="the-old-indic-shaping-model">
<h2>The old Indic shaping model<a class="headerlink" href="#the-old-indic-shaping-model" title="Permalink to this heading">¶</a></h2>
<p>The older Indic script tags (<code class="docutils literal notranslate"><span class="pre">&lt;deva&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;beng&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;gujr&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;guru&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;knda&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;mlym&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;orya&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;taml&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;telu&gt;</span></code>) have been deprecated. However,
shaping engines may still encounter fonts that were built to work with
these tags and some users may still have documents that were written to
take advantage of the original shaping rules.</p>
<section id="distinctions-from-the-indic2-model">
<h3>Distinctions from the Indic2 model<a class="headerlink" href="#distinctions-from-the-indic2-model" title="Permalink to this heading">¶</a></h3>
<p>The most significant distinction between the shaping models is that the
sequence of “Halant” and consonant glyphs used to trigger shaping
features) was altered when migrating from the old to the new shaping model.</p>
<p>Specifically, shaping engines were expected to reorder post-base
“Halant,<em>Consonant</em>” sequences to “<em>Consonant</em>,Halant”.</p>
<p>As a result, a font’s GSUB substitutions would be written to match
“<em>Consonant</em>,Halant” sequences in all pre-base and post-base positions.</p>
<p>The old-model Indic syllable</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pre-baseC Halant BaseC Halant Post-baseC
</pre></div>
</div>
<p>would be reordered to</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pre-baseC Halant BaseC Post-baseC Halant
</pre></div>
</div>
<p>before features are applied.</p>
<p>In Indic2 text, as described above in this document, there is no
such reordering. The correct sequence to match for GSUB substitutions is
“<em>Consonant</em>,Halant” for pre-base consonants, but “Halant,<em>Consonant</em>”
for post-base consonants.</p>
<p>The old Indic shaping model also did not recognize the
<code class="docutils literal notranslate"><span class="pre">BLWF_MODE_PRE_AND_POST</span></code> shaping characteristic. Instead, all scripts
were treated as if they followed the <code class="docutils literal notranslate"><span class="pre">BLWF_MODE_POST_ONLY</span></code>
characteristic. In other words, below-base form substitutions were
only applied to consonants after the base consonant or syllable base.</p>
<p>In addition, left-side dependent vowel marks
(matras) were not repositioned during the final reordering
stage. For <code class="docutils literal notranslate"><span class="pre">&lt;deva&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;beng&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;gujr&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;guru&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;knda&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;orya&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;telu&gt;</span></code> text, the left-side matra was always positioned
at the beginning of the syllable. For <code class="docutils literal notranslate"><span class="pre">&lt;mlym&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;taml&gt;</span></code> text, the
left-side matra was positioned immediately before the base consonant or syllable base.</p>
</section>
<section id="advice-for-handling-fonts-with-old-indic-features-only">
<h3>Advice for handling fonts with old Indic features only<a class="headerlink" href="#advice-for-handling-fonts-with-old-indic-features-only" title="Permalink to this heading">¶</a></h3>
<p>Shaping engines may choose to match post-base “<em>Consonant</em>,Halant”
sequences in order to apply GSUB substitutions when it is known that
the font in use supports only the old shaping model.</p>
</section>
<section id="advice-for-handling-text-runs-composed-in-the-old-indic-format">
<h3>Advice for handling text runs composed in the old Indic format<a class="headerlink" href="#advice-for-handling-text-runs-composed-in-the-old-indic-format" title="Permalink to this heading">¶</a></h3>
<p>Shaping engines may choose to match post-base “<em>Consonant</em>,Halant”
sequences for GSUB substitutions or to reorder them to
“Halant,<em>Consonant</em>” when processing text runs that are tagged with
one of the old Indic script tags and it is known that the font in use supports
only the Indic2 shaping model.</p>
<p>Shaping engines may also choose to apply <code class="docutils literal notranslate"><span class="pre">blwf</span></code> substitutions to
below-base consonants occuring before the base consonant when it is
known that the font in use supports an applicable substitution lookup.</p>
<p>Shaping engines may also choose to position left-side matras according
to the old-model Indic ordering scheme; however, doing so might interfere
with matching GSUB or GPOS features.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">OpenType Shaping Documents</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=n8willis&repo=opentype-shaping-documents&type=watch&count=True&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="README.html">Scripts</a></li>
    
    <li class="toctree-l1"><a href="character-tables/character-tables-index.html">Character tables</a></li>
    
    <li class="toctree-l1"><a href="opentype-shaping-normalization.html">Normalization</a></li>
    
    <li class="toctree-l1"><a href="notes/README.html">Notes</a></li>
    
    <li class="toctree-l1"><a href="errata.html">Errata</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Sponsored by YesLogic.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/opentype-shaping-indic-general.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>